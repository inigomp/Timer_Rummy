<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Temporizador Rummy — Responsive</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#7c63e6;
      --secondary:#5fc3a6;
      --bg-a: #f6f5ff;
      --bg-b: #f1fbf7;
      --card: rgba(255,255,255,0.9);
      --muted:#8c8fa3;
      --danger:#ef6b6b;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 12px 30px rgba(54,53,74,0.10);
      --radius:16px;
      --gap:12px;
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    /* Base layout - no scroll anywhere */
    html,body{
      height:100%;
      width:100%;
      margin:0;
      padding:0;
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background: linear-gradient(160deg,var(--bg-a), var(--bg-b));
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      color: #22212a;
    }
    body{
      min-height:100dvh;
      height:100dvh;
      width:100vw;
      overflow:hidden;
      box-sizing:border-box;
      -webkit-user-select:none;
      -ms-touch-action:manipulation;
      touch-action:manipulation;
    }

    /* Fullscreen panels */
    section.panel {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: calc(18px + var(--safe-top)) 14px calc(18px + var(--safe-bottom));
      box-sizing: border-box;
    }
    section.panel.active { display:flex; }

    /* Card container */
    .card {
      width: min(96vw,460px);
      background: linear-gradient(180deg, rgba(255,255,255,0.88), rgba(255,255,255,0.82));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(12px,4vw,28px);
      display:flex;
      flex-direction:column;
      gap: var(--gap);
      align-items: center;
      box-sizing:border-box;
      max-height: calc(100dvh - 3rem);
    }

    /* Header */
    .title {
      width:100%;
      text-align:center;
      font-weight:900;
      letter-spacing:-0.02em;
      font-size: clamp(1.1rem, 6.6vw, 1.9rem);
      line-height:1;
      margin:0;
      color: transparent;
      background: linear-gradient(90deg,var(--primary),var(--secondary));
      -webkit-background-clip:text;
      background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .subtitle {
      margin:0;
      color:var(--muted);
      font-weight:600;
      font-size:clamp(0.86rem,3.6vw,1rem);
      text-align:center;
    }

    /* Players input */
    .player-inputs {
      width:100%;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .player-inputs input {
      width:100%;
      box-sizing:border-box;
      padding: clamp(8px, 2.8vw, 12px);
      border-radius: 10px;
      border: 1px solid rgba(124,99,238,0.18);
      outline:none;
      font-weight:700;
      text-align:center;
      font-size: clamp(0.95rem, 3.7vw, 1rem);
      background: linear-gradient(180deg,#fff,#fbfbff);
    }

    /* Controls row */
    .controls {
      width:100%;
      display:flex;
      gap:10px;
      justify-content:center;
    }
    .controls button{
      flex:1;
      min-width:0;
      padding:10px;
      border-radius:10px;
      border:none;
      background: linear-gradient(90deg, rgba(124,99,238,0.12), rgba(95,195,166,0.06));
      color:var(--primary);
      font-weight:800;
      box-shadow: 0 6px 18px rgba(124,99,238,0.04);
      cursor:pointer;
    }

    /* Settings row */
    .settings {
      width:100%;
      display:flex;
      gap:10px;
      justify-content:space-between;
      align-items:center;
    }
    .settings .field {
      display:flex;
      flex-direction:column;
      gap:6px;
      align-items:flex-start;
      font-weight:700;
      color:var(--muted);
      font-size:clamp(0.86rem,3.2vw,1rem);
    }
    .settings input{
      width:84px;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid rgba(124,99,238,0.12);
      text-align:center;
      background:#fff;
      font-weight:800;
    }

    /* Primary start button */
    #startBtn {
      width:100%;
      margin-top:6px;
      padding: clamp(10px,3.5vw,14px);
      border-radius:12px;
      border:none;
      color:white;
      font-weight:900;
      font-size: clamp(1rem,4vw,1.3rem);
      background: linear-gradient(90deg,var(--primary),var(--secondary));
      box-shadow: 0 10px 30px rgba(124,99,238,0.12);
      cursor:pointer;
    }

    /* Select-first card tweaks */
    #selectFirst .card { align-items:stretch; gap:14px; }
    .first-player-btns { display:flex; flex-direction:column; gap:12px; }
    .first-player-btns button {
      padding:12px;
      border-radius:10px;
      border:2px solid rgba(124,99,238,0.22);
      background: linear-gradient(90deg,#f3f0ff,#effff7);
      font-weight:800;
      cursor:pointer;
    }

    /* Game UI */
    .game-card { width: min(96vw,420px); display:flex; flex-direction:column; gap:12px; align-items:center; }
    .turn-row { width:100%; display:flex; gap:12px; align-items:center; justify-content:center; }
    .avatar {
      width:48px; height:48px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg,var(--primary),var(--secondary));
      color:white; font-weight:900; font-size:1.05rem;
      box-shadow: 0 6px 18px rgba(124,99,238,0.12);
      flex-shrink:0;
    }
    .turn-text {
      display:flex;
      flex-direction:column;
      gap:2px;
      text-align:left;
    }
    .turn-label { font-weight:700; font-size:clamp(0.86rem,3.2vw,1rem); color:var(--muted); }
    .turn-name { font-weight:900; font-size:clamp(1.05rem,5.6vw,1.4rem); color:var(--primary); }

    /* Timer */
    #timer {
      font-variant-numeric:tabular-nums;
      font-weight:900;
      font-size: clamp(1.8rem, 10vw, 3.6rem);
      padding: clamp(10px, 3.8vw, 20px) clamp(16px,5vw,36px);
      border-radius:12px;
      background: linear-gradient(180deg,#fff,#fbfbff);
      box-shadow: 0 10px 30px rgba(49,46,78,0.06);
      color: #22212a;
      text-align:center;
      min-width:120px;
    }

    .game-btns { width:100%; display:flex; gap:10px; }
    .game-btns button {
      flex:1; padding:12px; border-radius:10px; border:none; font-weight:800; cursor:pointer;
      box-shadow: 0 6px 18px rgba(54,53,74,0.06);
    }
    #endTurnBtn{ background: linear-gradient(90deg,var(--primary),var(--secondary)); color:white; }
    #pauseBtn{ background: var(--card); color:var(--primary); border:1px solid rgba(95,195,166,0.12); }

    #endGameBtn {
      width:100%; padding:11px; border-radius:10px; border:none; background:var(--danger); color:white; font-weight:900;
    }

    /* Modal */
    .modal-bg {
      position: fixed; inset:0; display:none; align-items:center; justify-content:center;
      background: rgba(34,33,42,0.28); z-index:1200; padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bottom));
      box-sizing:border-box;
    }
    .modal-bg.active { display:flex; }
    .modal {
      width: min(92vw,380px); background: white; border-radius:12px; padding:16px; box-shadow: 0 18px 50px rgba(34,33,42,0.14);
      display:flex; flex-direction:column; gap:12px; align-items:center;
    }
    .modal p { margin:0; font-weight:800; color:#22212a; text-align:center; }
    .modal-actions { display:flex; gap:12px; width:100%; justify-content:center; }
    .modal-actions button { padding:10px 14px; border-radius:10px; border:none; font-weight:800; cursor:pointer; }
    .modal .confirm { background:var(--danger); color:white; }
    .modal .cancel { background: var(--card); color: #22212a; border:1px solid rgba(34,33,42,0.06); }

    @media (max-width:360px){
      .avatar{ width:42px; height:42px; font-size:0.95rem; }
      #timer{ font-size: clamp(1.4rem, 14vw, 2.6rem); padding:10px 18px; }
    }
  </style>
</head>
<body>
  <!-- MENU -->
  <section id="menu" class="panel active" aria-hidden="false">
    <div class="card" role="region" aria-label="Menú principal">
      <h1 class="title">Temporizador Rummy</h1>
      <p class="subtitle">Rápido, claro y preparado para móvil</p>

      <div class="player-inputs" id="players" aria-label="Jugadores"></div>

      <div class="controls" role="group" aria-label="Controles jugadores">
        <button id="addPlayer" type="button" aria-label="Añadir jugador">➕ Añadir</button>
        <button id="removePlayer" type="button" aria-label="Eliminar jugador">❌ Eliminar</button>
      </div>

      <div class="settings" aria-label="Ajustes">
        <div class="field">
          <label for="time">Tiempo (min)</label>
          <input id="time" type="number" min="1" max="99" value="10" />
        </div>
        <div class="field">
          <label for="penalty">Penalización (seg)</label>
          <input id="penalty" type="number" min="1" max="99" value="10" />
        </div>
      </div>

      <button id="startBtn" type="button">Comenzar</button>
    </div>
  </section>

  <!-- SELECT FIRST -->
  <section id="selectFirst" class="panel" aria-hidden="true">
    <div class="card" role="dialog" aria-label="Quién comienza">
      <label style="font-weight:900; color:var(--primary); font-size:clamp(1rem,4.5vw,1.2rem);">¿Quién comienza?</label>
      <div class="first-player-btns" id="firstPlayerBtns" aria-label="Seleccionar primer jugador"></div>
    </div>
  </section>

  <!-- GAME -->
  <section id="game" class="panel" aria-hidden="true">
    <div class="game-card card" role="region" aria-label="Partida">
      <div class="turn-row" role="status" aria-live="polite">
        <div class="avatar" id="turnAvatar">A</div>
        <div class="turn-text">
          <div class="turn-label">Turno de:</div>
          <div class="turn-name" id="turnName">Jugador 1</div>
        </div>
      </div>

      <div id="timer" aria-live="polite">0:00</div>

      <div class="game-btns">
        <button id="endTurnBtn" type="button">Fin de turno</button>
        <button id="pauseBtn" type="button">Pausa</button>
      </div>

      <button id="endGameBtn" type="button">Fin de partida</button>
    </div>
  </section>

  <!-- Modal confirmación -->
  <div id="confirmModalBg" class="modal-bg" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <p>¿Estás seguro de que quieres abandonar la partida?</p>
      <div class="modal-actions">
        <button class="confirm" id="confirmExitBtn" type="button">Sí, salir</button>
        <button class="cancel" id="cancelExitBtn" type="button">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const playersDiv = document.getElementById('players');
    const addPlayerBtn = document.getElementById('addPlayer');
    const removePlayerBtn = document.getElementById('removePlayer');
    const startBtn = document.getElementById('startBtn');
    const menu = document.getElementById('menu');
    const selectFirst = document.getElementById('selectFirst');
    const firstPlayerBtns = document.getElementById('firstPlayerBtns');
    const game = document.getElementById('game');
    const turnName = document.getElementById('turnName');
    const turnAvatar = document.getElementById('turnAvatar');
    const timerEl = document.getElementById('timer');
    const endTurnBtn = document.getElementById('endTurnBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const endGameBtn = document.getElementById('endGameBtn');
    const timeInput = document.getElementById('time');
    const penaltyInput = document.getElementById('penalty');

    const modalBg = document.getElementById('confirmModalBg');
    const confirmExitBtn = document.getElementById('confirmExitBtn');
    const cancelExitBtn = document.getElementById('cancelExitBtn');

    // State
    let players = [];
    let timers = [];
    let currentPlayer = 0;
    let interval = null;
    let paused = false;
    let penaltyTime = 10;
    let reachedZero = [];

    // Helpers
    function showPanel(id){
      [menu, selectFirst, game].forEach(p => {
        p.classList.remove('active');
        p.setAttribute('aria-hidden','true');
      });
      const map = { menu, selectFirst, game };
      map[id].classList.add('active');
      map[id].setAttribute('aria-hidden','false');
    }

    function setRandomBackground(){
      const grads = [
        'linear-gradient(160deg,#f7f6ff 0%, #f0fbf7 100%)',
        'linear-gradient(160deg,#fffaf8 0%, #f3fbff 100%)',
        'linear-gradient(160deg,#f9fbff 0%, #f4fff6 100%)'
      ];
      document.body.style.background = grads[Math.floor(Math.random()*grads.length)];
    }

    function addPlayerField(){
      if (playersDiv.children.length >= 6) return;
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = `Jugador ${playersDiv.children.length + 1}`;
      playersDiv.appendChild(input);
    }
    function removePlayerField(){
      if (playersDiv.children.length > 2){
        playersDiv.removeChild(playersDiv.lastChild);
      }
    }
    function getPlayerNames(){
      const inputs = Array.from(playersDiv.querySelectorAll('input'));
      if (!inputs.length) return ['Jugador 1','Jugador 2'];
      return inputs.map((el,i) => el.value.trim() || `Jugador ${i+1}`);
    }

    function showFirstPlayerSelection(names){
      firstPlayerBtns.innerHTML = '';
      names.forEach((name, i) => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.textContent = name;
        btn.addEventListener('click', () => beginGame(i, names));
        firstPlayerBtns.appendChild(btn);
      });
      showPanel('selectFirst');
    }
    function startGameSetup(){
      const names = getPlayerNames();
      if (names.length < 2) return alert('Debes tener al menos 2 jugadores');
      showFirstPlayerSelection(names);
    }

    // Game flow
    function beginGame(firstIndex, names){
      players = names;
      currentPlayer = firstIndex;
      const minutes = Math.max(1, parseInt(timeInput.value) || 10);
      penaltyTime = Math.max(1, parseInt(penaltyInput.value) || 10);
      timers = Array(players.length).fill(minutes * 60);
      reachedZero = Array(players.length).fill(false);
      paused = false;
      pauseBtn.textContent = 'Pausa';
      showPanel('game');
      updateTurnVisual();
      startTimer();
    }

    function updateTurnVisual(){
      const name = players[currentPlayer] || ('Jugador ' + (currentPlayer+1));
      // Avatar initials
      const initials = name.split(' ').map(n => n[0] || '').slice(0,2).join('').toUpperCase();
      turnAvatar.textContent = initials || 'J';
      turnName.textContent = name;
    }

    function startTimer(){
      clearInterval(interval);
      renderTime();
      interval = setInterval(() => {
        if (!paused) {
          if (timers[currentPlayer] > 0) {
            timers[currentPlayer]--;
            renderTime();
          } else {
            reachedZero[currentPlayer] = true;
            endTurn();
          }
        }
      }, 1000);
    }

    function renderTime(){
      const sec = Math.max(0, timers[currentPlayer] || 0);
      const m = Math.floor(sec / 60);
      const s = sec % 60;
      timerEl.textContent = `${m}:${s < 10 ? '0' + s : s}`;
    }

    function endTurn(){
      currentPlayer = (currentPlayer + 1) % players.length;
      updateTurnVisual();
      startTimer();
    }

    function togglePause(){
      paused = !paused;
      pauseBtn.textContent = paused ? 'Reanudar' : 'Pausa';
      pauseBtn.style.background = paused ? 'linear-gradient(90deg,var(--primary),var(--secondary))' : '';
      pauseBtn.style.color = paused ? '#fff' : '';
    }

    // Modal: timer keeps running while modal shown
    function showEndGameModal(){
      modalBg.classList.add('active');
      modalBg.setAttribute('aria-hidden','false');
      confirmExitBtn.focus();
    }
    function hideEndGameModal(){
      modalBg.classList.remove('active');
      modalBg.setAttribute('aria-hidden','true');
      endGameBtn.focus();
    }
    function confirmEndGame(){
      clearInterval(interval);
      modalBg.classList.remove('active');
      modalBg.setAttribute('aria-hidden','true');
      // Reset state and show menu with existing inputs (do not remove input fields)
      players = [];
      timers = [];
      currentPlayer = 0;
      paused = false;
      pauseBtn.textContent = 'Pausa';
      showPanel('menu');
    }

    // Events
    addPlayerBtn.addEventListener('click', addPlayerField);
    removePlayerBtn.addEventListener('click', removePlayerField);
    startBtn.addEventListener('click', startGameSetup);
    endTurnBtn.addEventListener('click', endTurn);
    pauseBtn.addEventListener('click', togglePause);
    endGameBtn.addEventListener('click', showEndGameModal);

    confirmExitBtn.addEventListener('click', confirmEndGame);
    cancelExitBtn.addEventListener('click', hideEndGameModal);
    modalBg.addEventListener('click', (e) => { if (e.target === modalBg) hideEndGameModal(); });
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modalBg.classList.contains('active')) hideEndGameModal();
    });

    // Init
    setRandomBackground();
    addPlayerField();
    addPlayerField();
    showPanel('menu');
    // ensure no accidental drag selection on mobile
    document.addEventListener('touchstart', ()=>{}, {passive:true});
  </script>
</body>
</html>
